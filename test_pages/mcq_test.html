<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MCQ Test Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 24px;
      }
      .question {
        font-weight: bold;
        margin-bottom: 12px;
      }
      .options {
        margin-left: 12px;
      }
      .trigger {
        margin-top: 16px;
      }
    </style>
  </head>
  <body>
    <div id="mcq-root">
      <div class="question" id="question">What is the capital of France?</div>
      <div class="options" id="options">
        <label><input type="radio" name="q1" value="A" /> A) Madrid</label
        ><br />
        <label><input type="radio" name="q1" value="B" /> B) Berlin</label
        ><br />
        <label><input type="radio" name="q1" value="C" /> C) Paris</label><br />
        <label><input type="radio" name="q1" value="D" /> D) Rome</label>
      </div>
    </div>

    <div class="trigger">
      <button id="next">Next Question</button>
      <button id="manual">Manual Trigger</button>
      <p>
        Click "Next Question" to cycle through sample MCQs. The extension will
        only trigger Gemini when keyboard shortcut or manual forced trigger is
        used. This page simulates a cluttered layout (timer, sidebar, and
        control buttons) to test extraction.
      </p>

      <div
        style="
          margin-top: 12px;
          padding: 8px;
          background: #f6f6f6;
          border-radius: 6px;
        "
      >
        <div style="font-weight: 600">Timer: <span id="timer">00:10</span></div>
        <div style="margin-top: 6px">
          Progress:
          <progress
            id="progress"
            value="1"
            max="4"
            style="width: 100%"
          ></progress>
        </div>
        <div style="margin-top: 6px">
          Other actions: <button id="ansButton">Submit</button>
          <button id="skip">Skip</button>
        </div>
      </div>

      <div style="margin-top: 8px; display: flex; gap: 12px">
        <div
          style="width: 120px; border-right: 1px solid #ddd; padding-right: 8px"
        >
          <div style="font-weight: 600">Questions</div>
          <ol id="qList">
            <li>Q1</li>
            <li>Q2</li>
            <li>Q3</li>
            <li>Q4</li>
          </ol>
        </div>
        <div style="flex: 1">
          <!-- The main question UI sits here -->
        </div>
      </div>
    </div>

    <script>
      const questions = [
        {
          q: "What is the capital of France?",
          opts: ["Madrid", "Berlin", "Paris", "Rome"],
        },
        {
          q: "Which planet is known as the Red Planet?",
          opts: ["Venus", "Mars", "Jupiter", "Saturn"],
        },
        {
          q: "Which element has the chemical symbol O?",
          opts: ["Gold", "Oxygen", "Silver", "Hydrogen"],
        },
        {
          q: "Which language is primarily used for Android app development?",
          opts: ["Swift", "Kotlin", "PHP", "Ruby"],
        },
      ];

      let idx = 0;
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");

      function renderQuestion(i) {
        const item = questions[i % questions.length];
        questionEl.textContent = item.q;
        // remove previous options
        optionsEl.innerHTML = "";
        const name = "q1";
        item.opts.forEach((opt, j) => {
          const label = document.createElement("label");
          const input = document.createElement("input");
          input.type = "radio";
          input.name = name;
          input.value = String.fromCharCode(65 + j);
          label.appendChild(input);
          label.appendChild(
            document.createTextNode(
              " " + String.fromCharCode(65 + j) + ") " + opt,
            ),
          );
          optionsEl.appendChild(label);
          optionsEl.appendChild(document.createElement("br"));
        });
      }

      document.getElementById("next").addEventListener("click", () => {
        idx = (idx + 1) % questions.length;
        renderQuestion(idx);
        // update the progress bar and timer simulating a real quiz UI
        const progress = document.getElementById("progress");
        progress.value = idx + 1;
        document.getElementById("timer").textContent =
          "00:" + String(10 - idx).padStart(2, "0");
        // highlight active in sidebar
        const qList = document.getElementById("qList");
        Array.from(qList.children).forEach((c, i) => {
          c.style.fontWeight = i === idx ? "700" : "400";
        });
      });

      // Manual trigger for testing: posts the MCQ_SCAN message the content script listens to
      document.getElementById("manual").addEventListener("click", () => {
        // Post a forced scan for testing
        window.postMessage({ type: "MCQ_SCAN", forced: true }, "*");
      });

      // For convenience while testing: intercept Alt+Shift+Z on the page and post a forced scan
      document.addEventListener("keydown", (ev) => {
        if (ev.altKey && ev.shiftKey && ev.code === "KeyZ") {
          ev.preventDefault();
          window.postMessage({ type: "MCQ_SCAN", forced: true }, "*");
        }
      });
      // Simulate automatic change of question content occasionally so the extension can be tested
      setInterval(() => {
        // randomly change to simulate dynamic content
        if (Math.random() > 0.7) {
          document.getElementById("next").click();
        }
      }, 6000);

      // Initial render
      renderQuestion(idx);
    </script>
  </body>
</html>
